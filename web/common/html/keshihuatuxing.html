<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
	<title>可视化图像</title>
	<script type="text/javascript" src="../jquery.min.js"></script>
	<script type="text/javascript" src="../layer.js"></script>
	<script type="text/javascript" src="../common.js"></script>
	<script type="text/javascript" src="../moment.js"></script>
	<script src="../echarts.min.js"></script>
	<script type="text/javascript" src="../js/jquery.ztree.all-3.5.min.js"></script>
	<link rel="stylesheet" type="text/css" href="../theme/default/gis.css"/>
	<link rel="stylesheet" type="text/css" href="../theme/default/style.css"/>
	<link rel="stylesheet" type="text/css" href="../theme/default/H-ui.min.css"/>
	<link rel="stylesheet" type="text/css" href="../theme/default/H-ui.reset.css"/>
	<link rel="stylesheet" href="../js/bootstrap-3.3.7-dist/css/bootstrap.min.css">
	<style type="text/css">
		body{
			width: 100%;
			height: 100%;
			background-color: #021c40;
		}
	</style>
</head>

<body>
<div>
	<div class="shujutu" style="width:100%;border-bottom:4px solid #000000;height:60px">
		<label style="margin-left:5px;color:white;font-size:10px"><Icon type="environment" /></label>
		<img src="../images/keshihua.png" alt="" style="color:white;font-size:35px;font-weight:bold;display:block;margin-top: -40px">
	</div>
	<ul style="float: left;width: 90%;height: auto;margin-left: 5%;border-bottom:1px solid #2b3b4b;border-top:1px solid #2b3b4b;">
		<div style="float:left;height:400px;width:60%;margin-left: 5%;">
			<li id="personnelStatusRingChart" style="float:left;height:450px;width:90%;list-style:none;margin-left: 5%">
			</li>
		</div>
		<div style="float:left;height:400px;width:30%;margin-left: 5%;">
			<label style="color: white;font-size: 20px;margin-left: 5.5%;margin-top: 35px ">粮油消耗情况堆叠图</label>
			<hr width=90% style="margin-left: 5.5%;margin-top: 4px;background-color: #17FFE7;height: 1px;border: none">
			<div id="liangyouxiaohaoLineChart" style="height:70%;width:70%; position: relative;left: 15%; top: 5%;">
			</div>
		</div>
		<div style="float:left;height:600px;width:28%;margin-left: 5%;">
			<label style="color: white;font-size: 20px;margin-left: 5.5%;margin-top: 35px ">用药频率环形图</label>
			<hr width=90% style="margin-left: 5.5%;margin-top: 4px;background-color: #17FFE7;height: 1px;border: none">
			<div id="yongyaoPinlvRingChart" style="height:70%;width:85%; position: relative;left: 5%; top: 5%;">
			</div>
		</div>
		<div style="float:left;height:600px;width:28%;margin-left: 5%;">
			<label style="color: white;font-size: 20px;margin-left: 5.5%;margin-top: 35px ">用车记录柱状图</label>
			<hr width=90% style="margin-left: 5.5%;margin-top: 4px;background-color: #17FFE7;height: 1px;border: none">
			<div id="yongchejiluBarChart" style="height:70%;width:70%; position: relative;left: 15%; top: 5%;">
			</div>
		</div>
		<div style="float:left;height:600px;width:28%;margin-left: 5%;">
			<label style="color: white;font-size: 20px;margin-left: 5.5%;margin-top: 35px ">房间使用情况柱状图</label>
			<hr width=90% style="margin-left: 5.5%;margin-top: 4px;background-color: #17FFE7;height: 1px;border: none">
			<div id="fangjianshiyongBarChart" style="height:70%;width:70%; position: relative;left: 15%; top: 5%;">
			</div>
		</div>
	</ul>
</div>

<script>



	//后台数据获取
	$(document).ready(function(){
		refresh();
	});

	window.setInterval(refresh, 60000);

	function refresh() {
		getpersonnelStatusRingChart();
		getyongyaoPinlvRingChart();
		getyongchejiluBarChart();
		getliangyouxiaohaoLineChart();
		getfangjianshiyongBarChart();
	}

	//人员在营状态情况数据获取
	var a={name:[]};
	var renyuanList=[]
	var zongrenshu=''
	var zaiyingrenshu=''
	var qingjiarenshu=''
	var nianjiarenshu=''
	var lunxiurenshu=''
	var paiqianrenshu=''
	function getpersonnelStatusRingChart() {
		$.ajax({
			type : 'GET',
			url : SERVER + "personnelStatusRingChart" ,
			success : function (data) {
				let list = [];
				if (data.status != 0) {
					message.warning(data.message);
					return;
				}
				for (let i = 0; i < data.data.data.length; i++) {
					let obj={};
					obj.name= data.data.data[i]["name"];
					obj.value= data.data.data[i]["value"];
					list.push(obj);
				}
				zongrenshu=data.data.zongrenshu,
						renyuanList=list;
				a.name=data.data.name
				person();
			}
		});
	}

	//药品使用情况环形图数据获取
	var yaopinmingcheng=[]
	var yaopinList=[]
	function getyongyaoPinlvRingChart() {
		$.ajax({
			type : 'GET',
			url : SERVER + "yongyaoPinlvRingChart" ,
			success : function (data) {
				let list = [];
				if (data.status != 0) {
					message.warning(data.message);
					return;
				}
				for (let i = 0; i < data.data.data.length; i++) {
					let obj={};
					obj.name= data.data.data[i]["name"];

					obj.value= data.data.data[i]["value"];
					list.push(obj);
				}
				yaopinList=list;
				yaopinmingcheng=data.data.yaopinmingcheng;
				getoption2()
			}
		});
	}
	//用车记录情况数据获取
	var dateList=[]
	var carData=[]
	function getyongchejiluBarChart() {
		$.ajax({
			type : 'GET',
			url : SERVER + "yongchejiluBarChart" ,
			success : function (data) {
				let list = [];
				if (data.status != 0) {
					message.warning(data.message);
					return;
				}
				for (let i = 0; i < data.data.series.length; i++) {
					let obj={};
					obj.name= data.data.series[i]["date"];
					obj.data= data.data.series[i]["count"];
					list.push(obj);
				}
				dateList=data.data.dateList
				carData=list
				getoption3()
			}
		});
	}

	//粮油消耗数据获取
	var dateList2=[]
	var xiaohaoData=[]
	var nameList=[]
	var damiData=[]
	var baimianData=[]
	var douyouData=[]
	var jiangyouData=[]
	var yanData=[]
	var cuData=[]
	function getliangyouxiaohaoLineChart() {
		$.ajax({
			type : 'GET',
			url : SERVER + "liangyouxiaohaoLineChart" ,
			success : function (data) {
				let list = [];
				dateList2=[]
				xiaohaoData=[]
				nameList=[]
				damiData=[]
				baimianData=[]
				douyouData=[]
				jiangyouData=[]
				yanData=[]
				cuData=[]
				if (data.status != 0) {
					message.warning(data.message);
					return;
				}
				for (let i = 0; i < data.data.series.length; i++) {
					data.data.series[i]["key"] = i;
					if(data.data.series[i]["name"]=='白面'){
						baimianData.push(data.data.series[i]["value"])
					}
					if(data.data.series[i]["name"]=='醋'){
						cuData.push(data.data.series[i]["value"])
					}
					if(data.data.series[i]["name"]=='大米'){
						damiData.push(data.data.series[i]["value"])
					}
					if(data.data.series[i]["name"]=='豆油'){
						douyouData.push(data.data.series[i]["value"])
					}
					if(data.data.series[i]["name"]=='酱油'){
						jiangyouData.push(data.data.series[i]["value"])
					}
					if(data.data.series[i]["name"]=='盐'){
						yanData.push(data.data.series[i]["value"])
					}
				}
				dateList2=data.data.dateList
				nameList=data.data.nameList
				xiaohaoData=data.data.series
				getoption4()
			}
		});
	}

	//房间使用数据获取
	var roomList=[]
	var roomData=[]
	function getfangjianshiyongBarChart() {
		$.ajax({
			type : 'GET',
			url : SERVER + "fangjianshiyongBarChart" ,
			success : function (data) {
				let list = [];
				if (data.status != 0) {
					message.warning(data.message);
					return;
				}
				roomList=data.data.nameList
				roomData=data.data.series
				getoption5()
			}
		});
	}

	function zuhzileft(index){
		if(index > 4){
			return index - 5;
		}else{
			return index;
		}
	}
	function zuhzitop(index){
		if(index > 4){
			return 85;
		}else{
			return 50;
		}
	}

	//人员在营状态统计图
	var myChart = echarts.init(document.getElementById('personnelStatusRingChart'));
	var titleArr= [], seriesArr=[];
	colors=[['#389af4', '#dfeaff'],['#ff8c37', '#ffdcc3'],['#ffc257', '#ffedcc'], ['#fd6f97', '#fed4e0'],['#a181fc', '#e3d9fe'],['#389af4', '#dfeaff'],['#ff8c37', '#ffdcc3'],['#ffc257', '#ffedcc'], ['#fd6f97', '#fed4e0'],['#a181fc', '#e3d9fe']]
	function person(){
		renyuanList.forEach(function(item, index){
			titleArr.push(
					{
						text:item.name + '(' + item.value + '人)',
						left: zuhzileft(index) * 20 + 10 +'%',
						top:  zuhzitop(index) + '%',
						textAlign: 'center',
						textStyle: {
							fontWeight: 'normal',
							fontSize: '12',
							color: colors[index]!== undefined ? colors[index][0] : '#dfeaff',
							textAlign: 'center',
						},
					}
			);
			seriesArr.push(
					{
						name: item.name,
						type: 'pie',
						clockWise: false,
						radius: [40, 60],
						itemStyle:  {
							normal: {
								color: colors[index]!== undefined ? colors[index][0] : '#dfeaff',
								shadowColor: colors[index]!== undefined ? colors[index][0] : '#dfeaff',
								shadowBlur: 0,
								label: {
									show: false
								},
								labelLine: {
									show: false
								},
							}
						},
						hoverAnimation: false,
						center: [zuhzileft(index) * 20 + 10 +'%', (parseInt(index/5)+1)*35 + '%'],
						data: [{
							value: item.value,
							label: {
								normal: {
									formatter: function(params){
										return ((params.value/zongrenshu)*100).toFixed(2)+'%\n(总:' + zongrenshu + '人）';   //保留两位小数
									},
									position: 'center',
									show: true,
									textStyle: {
										fontSize: '14',
										fontWeight: 'bold',
										color: colors[index]!== undefined ? colors[index][0] : '#dfeaff',
									}
								}
							},
						}, {
							value: zongrenshu-item.value,
							name: 'invisible',
							itemStyle: {
								normal: {
									color: colors[index]!== undefined ? colors[index][1] : '#dfeaff',
								},
								emphasis: {
									color: colors[index]!== undefined ? colors[index][1] : '#dfeaff',
								}
							}
						}]
					}
			)
		});
		getoption1();
	}
	var option1 ={}
	function getoption1(){
		option1 = {
			title:titleArr,
			series: seriesArr,
			// tooltip: {    //提示框
			// 	trigger: 'item',
			// 	formatter: "总人数："+zongrenshu+"人<br/><br/>{a} : {c}人 ({d}%)"
			// },
		};
		myChart.setOption(option1);
	}



	//用药频率统计图
	var myChart1= echarts.init(document.getElementById('yongyaoPinlvRingChart'));
	var colors2 = ['#5793f3', '#00FF7F', '#675bba','#F08080'];
	let option2={}
	function getoption2(){
		option2 = {
			color:colors2,
			tooltip: {
				trigger: 'item',
				formatter: "{a} <br/>{b}: {c} ({d}%)"
			},
			// toolbox: {
			// 	feature: {
			// 		dataView: {readOnly: false},
			// 		restore: {},
			// 		saveAsImage: {}
			// 	}
			// },
			legend: {
				data:yaopinmingcheng,
				textStyle:{
					color:'#F5FFFA',
					fontSize:'12'
				},
			},
			// grid:{
			// 	height:'450px',
			// 	top:'70px',
			// },
			series: [
				{
					name:'用药频率',
					type:'pie',
					radius: ['30%', '40%'],
					center: ['50%', '60%'],
					avoidLabelOverlap: false,
					label: {
						normal: {
							formatter: "{b}: {c} ({d}%)",
							// show: false,
							// position: 'center'
							fontSize:'8'
						},
					},
					// labelLine: {
					// 	normal: {
					// 		show: false
					// 	}
					// },
					data:yaopinList
				}
			]
		};
		myChart1.setOption(option2);
	}

	//用车记录统计图
	var myChart2 = echarts.init(document.getElementById('yongchejiluBarChart'));
	var colors3 = ['#00FF7F','#5793f3' , '#675bba'];
	let option3={}
	function getoption3(){
		var carName=[]
		var carCount=[]
		carData.forEach(function (item,index) {
			carName.push(item.name)
			carCount.push(item.data)
		})
		option3={
			tooltip: {
				trigger: 'axis',
				axisPointer: {
					type: 'shadow'
				}
			},
			// toolbox: {
			// 	feature: {
			// 		dataView: {readOnly: false},
			// 		restore: {},
			// 		saveAsImage: {}
			// 	}
			// },
			legend: {
				data:dateList,
				textStyle:{
					color:'#675bba'
				},
				top:'25px',
			},
			grid: {
				top: '15%',
				right: '3%',
				left: '12%',
				bottom: '14%',
				height:'300px',

			},
			xAxis: [{
				type: 'category',
				data: dateList,
				axisLine: {
					lineStyle: {
						color: 'rgba(255,255,255,0.12)'
					}
				},
				axisLabel: {
					margin: 10,
					color: '#e2e9ff',
					textStyle: {
						fontSize: 16
					},
				},
			}],
			yAxis: [{
				axisLabel: {
					formatter: '{value}',
					color: '#e2e9ff',
					textStyle: {
						fontSize: 16
					},
				},
				axisLine: {
					show: false
				},
				splitLine: {
					lineStyle: {
						color: 'rgba(255,255,255,0.12)'
					}
				}
			}],
			series: [{
				type: 'bar',
				data: carCount,
				barWidth: '20px',
				itemStyle: {
					normal: {
						color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
							offset: 0,
							color: 'rgba(0,244,255,1)' // 0% 处的颜色
						}, {
							offset: 1,
							color: 'rgba(0,77,167,1)' // 100% 处的颜色
						}], false),
						barBorderRadius: [30, 30, 30, 30],
						shadowColor: 'rgba(0,160,221,1)',
						shadowBlur: 4,
					}
				},
				label: {
					normal: {
						show: true,
						lineHeight: 30,
						width: 40,
						height: 30,
						backgroundColor: 'rgba(0,160,221,0.1)',
						borderRadius: 200,
						position: ['-8', '-60'],
						distance: 1,
						formatter: [
							'    {d|●}',
							' {a|{c}}     \n',
							'    {b|}'
						].join(','),
						rich: {
							d: {
								color: '#3CDDCF',
							},
							a: {
								color: '#fff',
								align: 'center',
							},
							b: {
								width: 1,
								height: 30,
								borderWidth: 1,
								borderColor: '#234e6c',
								align: 'left'
							},
						}
					}
				}
			}]
		}
		myChart2.setOption(option3);
	}


	//粮油消耗情况统计图
	var myChart3 = echarts.init(document.getElementById('liangyouxiaohaoLineChart'));
	var colors4 = [ '#5793f3', '#00FF7F','#F08080'];
	var fontColor = '#30eee9';
	function getoption4(){
		option4 = {
			color: colors4,
			tooltip : {   //提示框组件
				trigger: 'axis',  //坐标轴触发，主要在柱状图，折线图等会使用类目轴的图表中使用
				axisPointer: {
					type: 'cross',
					label: {
						backgroundColor: '#6a7985'
					}
				}
			},
			// toolbox: {
			// 	feature: {
			// 		dataView: {readOnly: false},
			// 		restore: {},
			// 		saveAsImage: {}
			// 	}
			// },
			legend: {
				show:true,
				x:'center',
				top:'12%',
				y:'35',
				icon: 'stack',
				itemWidth:10,
				itemHeight:10,
				textStyle:{
					color:'#1bb4f6',
					fontSize:18
				},
				data:nameList
			},
			grid: {
				left: '9%',
				right: '10%',
				top:'20%',
				bottom: '15%',
				containLabel: true
			},
			xAxis:  [
				{
					type : 'category',
					boundaryGap : false,
					axisLabel:{
						color: fontColor,
						textStyle: {
							fontSize: 16
						},
					},
					axisLine:{
						show:true,
						lineStyle:{
							color:'#397cbc'
						},
					},
					axisTick:{
						show:false,
					},
					splitLine:{
						show:false,
						lineStyle:{
							color:'#195384'
						}
					},
					data : dateList2.reverse()
				}
			],
			yAxis: [
				{
					type : 'value',
					min:0,
					axisLabel : {
						formatter: '{value}',
						textStyle:{
							color:'#2ad1d2',
							fontSize:16
						}
					},
					axisLine:{
						lineStyle:{
							color:'#27b4c2'
						},
					},
					axisTick:{
						show:false,
					},
					splitLine:{
						show:true,
						lineStyle:{
							color:'#11366e'
						}
					}
				},
			],
			series: [
				{
					name:'白面',
					type:'line',
					stack: '总量',
					// symbol:'circle',
					label: {
						normal: {
							show: true,
							position: 'right',
							fontSize:'20px'
						}
					},
					// symbolSize: 8,
					itemStyle: {
						normal: {
							color:'#0092f6',
							lineStyle: {
								color: "#0092f6",
								width:1
							},
							areaStyle: {
								color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
									offset: 0,
									color: 'rgba(7,44,90,0.3)'
								}, {
									offset: 1,
									color: 'rgba(0,146,246,0.9)'
								}]),
							}
						}
					},
					// markPoint:{
					// 	itemStyle:{
					// 		normal:{
					// 			color:'red'
					// 		}
					// 	}
					// },
					data:baimianData
				},
				{
					name:'醋',
					type:'line',
					// stack: '总量',
					// symbol:'circle',
					// symbolSize: 8,
					label: {
						normal: {
							show: true,
							position: 'right',
							fontSize:'20px'
						}
					},
					itemStyle: {
						normal: {
							color:'#00d4c7',
							lineStyle: {
								color: "#00d4c7",
								width:1
							},
							areaStyle: {
								color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
									offset: 0,
									color: 'rgba(7,44,90,0.3)'
								}, {
									offset: 1,
									color: 'rgba(0,212,199,0.9)'
								}]),
							}
						}
					},
					data:cuData
				},
				{
					name:'大米',
					type:'line',
					// stack: '总量',
					// symbol:'circle',
					// symbolSize: 8,
					label: {
						normal: {
							show: true,
							position: 'right',
							fontSize:'20px'
						}
					},
					itemStyle: {
						normal: {
							color: '#aecb56',
							lineStyle: {
								color: "#aecb56",
								width:1
							},
							areaStyle: {
								color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
									offset: 0,
									color: 'rgba(7,44,90,0.3)'
								}, {
									offset: 1,
									color: 'rgba(114,144,89,0.9)'
								}]),
							}
						}
					},
					data:damiData
				},
				{
					name:'豆油',
					type:'line',
					label: {
						normal: {
							show: true,
							position: 'right',
							fontSize:'20px'
						}
					},
					// stack: '总量',
					// symbol:'circle',
					// symbolSize: 8,
					itemStyle: {
						normal: {
							color: '#3A44FB',
							lineStyle: {
								color: "#3A44FB",
								width:1
							},
							areaStyle: {
								color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
									offset: 0,
									color: 'rgba(7,46,101,0.3)'
								}, {
									offset: 1,
									color: 'rgba(0,166,246,0.9)'
								}]),
							}
						}
					},
					data:douyouData
				},
				{
					name:'酱油',
					type:'line',
					// stack: '总量',
					// symbol:'circle',
					// symbolSize: 8,
					label: {
						normal: {
							show: true,
							position: 'right',
							fontSize:'20px'
						}
					},
					itemStyle: {
						normal: {
							color: '#6FE81A',
							lineStyle: {
								color: "#6FE81A",
								width:1
							},
							areaStyle: {
								color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
									offset: 0,
									color: 'rgba(7,44,90,0.3)'
								}, {
									offset: 1,
									color: 'rgba(0,212,199,0.9)'
								}]),
							}
						}
					},
					data:jiangyouData
				},
				{
					name:'盐',
					type:'line',
					// stack: '总量',
					// symbol:'circle',
					// symbolSize: 8,
					label: {
						normal: {
							show: true,
							position: 'right',
							fontSize:'20px'
						}
					},
					itemStyle: {
						normal: {
							color: '#aecb56',
							lineStyle: {
								color: "#aecb56",
								width:1
							},
							areaStyle: {
								color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
									offset: 0,
									color: 'rgba(7,44,90,0.3)'
								}, {
									offset: 1,
									color: 'rgba(0,212,199,0.9)'
								}]),
							}
						}
					},
					data:yanData
				}
			]
		}
		myChart3.setOption(option4);
	};


	//房间使用情况统计图
	var myChart4= echarts.init(document.getElementById('fangjianshiyongBarChart'));
	var roomname=[]
	var roomvalue=[]
	function getoption5(){
		roomData.forEach(function (item) {
			roomname.push(item.name)
			roomvalue.push(item.count)
		})
		option5 = {
			tooltip: {
				trigger: 'axis',
				axisPointer: { // 坐标轴指示器，坐标轴触发有效
					type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
				}
			},
			// toolbox: {
			// 	feature: {
			// 		dataView: {readOnly: false},
			// 		restore: {},
			// 		saveAsImage: {}
			// 	}
			// },
			xAxis: {
				data: roomList,
				offset: 12,
				axisLine: {
					onZero: false,
					lineStyle: {
						color: '#F5FFFA'
					},
				},
				axisLabel:{
					textStyle:{
						fontSize:16
					}
				}
			},
			yAxis: {
				axisLine: {
					onZero: false,
					lineStyle: {
						color: '#F5FFFA'
					},
				},
				axisLabel:{
					textStyle:{
						fontSize:16
					}
				}
			},
			series: [{
				name: '使用次数',
				type: 'bar',
				barWidth: '30%',
				label: {
					normal: {
						show: true,
						lineHeight: 30,
						width: 40,
						height: 30,
						backgroundColor: 'rgba(0,160,221,0.1)',
						borderRadius: 200,
						position: ['-8', '-60'],
						distance: 1,
						formatter: [
							'    {d|●}',
							' {a|{c}}     \n',
							'    {b|}'
						].join(','),
						rich: {
							d: {
								color: '#3CDDCF',
							},
							a: {
								color: '#fff',
								align: 'center',
							},
							b: {
								width: 1,
								height: 30,
								borderWidth: 1,
								borderColor: '#234e6c',
								align: 'left'
							},
						}
					}
				},
				data: [{
					name: roomname[0],
					value: roomvalue[0],
					itemStyle: {
						color: '#FFC257',
						barBorderRadius: 20,
					}
				},
					{
						name: roomname[1],
						value: roomvalue[1],
						itemStyle: {
							color: '#17FFE7',
							barBorderRadius: 20,
						}
					},
					{
						name: roomname[2],
						value: roomvalue[2],
						itemStyle: {
							color: '#00FF7F',
							barBorderRadius: 20,
						}
					},
					{
						name: roomname[3],
						value: roomvalue[3],
						itemStyle: {
							color: '#5793f3',
							barBorderRadius: 20,
						}
					},
					{
						name: roomname[4],
						value: roomvalue[4],
						itemStyle: {
							color: '#675bba',
							barBorderRadius: 20,
						}
					},
				]
			}]
		}
		myChart4.setOption(option5);
	}


</script>

</body>
</html>