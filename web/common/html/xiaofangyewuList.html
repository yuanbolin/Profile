<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>消防业务列表</title>
    <link rel="stylesheet" href="../js/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/xiaofangList.css">
</head>

<body>
    <div class='searchbox'>
        <div style="width: 90%;">
            <div class="input-group">
                <span class="input-group-addon" >
                  <i class="searchIcon"></i>
                </span>
                <input type="text" id='search' class="form-control" placeholder="输入文字开始搜索"
                    aria-describedby="sizing-addon1">
            </div>
        </div>
    </div>
    <div id="menu">

    </div>
    <div id="aaa" style="height:92vh;overflow-y:scroll;">

    </div>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../common.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            function GetRequest() {
                var url = location.search; //获取url中"?"符后的字串
                var theRequest = new Object();
                if (url.indexOf("?") != -1) {
                    var str = url.substr(1);
                    strs = str.split("&");
                    for (var i = 0; i < strs.length; i++) {
                        theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                    }
                }
                return theRequest;
            }
            let params = GetRequest();
            function getList(biaoti) {
                $.ajax({
                    url: SERVER + `yunsousuo/h5/zilanmu-wenzhang/${params.zhulanmubianhao}${biaoti ? "?biaoti=" + biaoti : ""}`,
                    // url: `https://xunte.vip/api/yunsousuo/h5/zilanmu-wenzhang/${params.zhulanmubianhao}${biaoti ? "?biaoti=" + biaoti : ""}`,
                    type: 'GET',
                    success: function (res) {
                        console.log(res);
                        if (res.status == 0) {
                            $('#menu').html('');
                            $('#aaa').html('');
                            for (let i = 0; i < res.data.length; i++) {
                                let item = res.data[i];
                                $('#menu').append(`<a href="#${'content_' + i}"class= "${'menu_item_' + i}" > ${item.biaoti}</a>`);
                                $('#aaa').append(`
                                     <div id = '${'content_' + i}' class= "list-group ${'content_' + i}" >
                                         <a href="#" class="list-group-item disabled">
                                             ${item.biaoti}
                                          </a>
                                     </div>
                    `);
                                for (let j = 0; j < item.wenzhangList.length; j++) {
                                    const element = item.wenzhangList[j];
                                    $(`.content_${i}`).append(`
                                      <a href = "#" id = "${element.wenzhangbianhao}"  class="list-group-item xiangqing" > ${element.biaoti}</a>
                              `)
                                }
                            }
                            $('.xiangqing').click(function () {
                                console.log($(this).attr('id'));
                                $(this).attr('href', `./xiaofangyewu_xiangqing.html?wenzhangbianhao=${$(this).attr('id')}`)
                            })
                        }
                    },
                    fail: function (error) {
                        console.log('error', error);
                        alert('网络错误')
                    }
                });
            }

            getList();
            $('#search').on('input', function () {
                getList($('#search').val())
            })

        });
    </script>
</body>

</html>
